<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Node-activerecord by meltingice</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Node-activerecord</h1>
        <p>A ORM written in Coffeescript that supports multiple database systems (SQL/NoSQL) and ID generation middleware.</p>
        <p class="view"><a href="https://github.com/meltingice/node-activerecord">View the Project on GitHub <small>meltingice/node-activerecord</small></a></p>
        <ul>
          <li><a href="https://github.com/meltingice/node-activerecord/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/meltingice/node-activerecord/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/meltingice/node-activerecord">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>node-activerecord</h1>

<p>An ORM written in Coffeescript that supports multiple database systems (SQL, NoSQL, and even REST), as well as ID generation middleware. It is fully extendable to add new database systems and plugins.</p>

<p><strong>Note:</strong> this project is new and is still evolving rapidly. A lot is done, but there is still a lot to do.</p>

<h2>Install</h2>

<p>node-activerecord is available in npm:</p>

<pre><code>npm install activerecord
</code></pre>

<p>Installing node-activerecord will not automatically install the required libraries for every adapter since this could easily make the library very bloated and dependent on things you may or may not need.</p>

<h3>Adapter Libraries</h3>

<p>You can use npm to install the required libraries for each adapter:</p>

<table>
<tr>
<th>Adapter</th>
    <th>Libraries</th>
  </tr>
<tr>
<td>sqlite</td>
    <td>sqlite3</td>
  </tr>
<tr>
<td>mysql</td>
    <td>mysql</td>
  </tr>
<tr>
<td>redis</td>
    <td>redis</td>
  </tr>
<tr>
<td>REST</td>
    <td>restler</td>
  </tr>
</table><h3>ID Middleware Libraries</h3>

<p>You can also use npm to install the required libraries for any ID generation middleware:</p>

<table>
<tr>
<th>Middleware</th>
    <th>Libraries</th>
  </tr>
<tr>
<td>sql</td>
    <td><i>none</i></td>
  </tr>
<tr>
<td>redis</td>
    <td>redis</td>
  </tr>
</table><h3>Built-In Plugins</h3>

<table>
<tr>
<th>Plugin</th>
    <th>Enabled by Default</th>
    <th>Description</th>
  </tr>
<tr>
<td>json</td>
    <td>true</td>
    <td>Allows conversion of a model to a simple JS object and offers field protection</td>
  </tr>
<tr>
<td>logger</td>
    <td>false</td>
    <td>A verbose logger that outputs significant logging data to the console</td>
  </tr>
</table><h2>Examples</h2>

<p><strong>Configuration</strong></p>

<p>By default, ActiveRecord assumes SQL ID middleware. This means it checks for the last generated auto-increment ID on the primary key.</p>

<div class="highlight">
<pre><span class="nv">ActiveRecord = </span><span class="nx">require</span> <span class="s">'activerecord'</span>

<span class="nv">module.exports = </span><span class="k">new</span> <span class="nx">ActiveRecord</span><span class="p">.</span><span class="nx">Configuration</span>
  <span class="nv">sqlite:</span>
    <span class="nv">database: </span><span class="s">"</span><span class="si">#{</span><span class="nx">__dirname</span><span class="si">}</span><span class="s">/test.db"</span>
  <span class="nv">mysql:</span>
    <span class="nv">host: </span><span class="s">'localhost'</span>
    <span class="nv">database: </span><span class="s">'test'</span>
    <span class="nv">user: </span><span class="s">'test'</span>
    <span class="nv">password: </span><span class="s">'password'</span>
  <span class="nv">middleware:</span>
    <span class="nv">redis:</span>
      <span class="nv">host: </span><span class="s">'localhost'</span>
</pre>
</div>


<p><strong>Model Definition</strong></p>

<div class="highlight">
<pre><span class="nv">ActiveRecord = </span><span class="nx">require</span> <span class="s">'activerecord'</span>
<span class="nv">config = </span><span class="nx">require</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s">"/config"</span>

<span class="c1"># Note: uses sqlite3 by default</span>
<span class="k">class</span> <span class="nx">User</span> <span class="k">extends</span> <span class="nx">ActiveRecord</span><span class="p">.</span><span class="nx">Model</span>
  <span class="nv">config: </span><span class="nx">config</span>
  <span class="nv">fields: </span><span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'username'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">]</span>
</pre>
</div>


<p><strong>Creating a Record</strong></p>

<div class="highlight">
<pre><span class="nv">user = </span><span class="k">new</span> <span class="nx">User</span><span class="p">()</span>
<span class="nv">user.username = </span><span class="s">"meltingice"</span>
<span class="nv">user.name = </span><span class="s">"Ryan"</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
</pre>
</div>


<p><strong>Retreiving a Record</strong></p>

<div class="highlight">
<pre><span class="c1"># Find by primary ID</span>
<span class="nx">User</span><span class="p">.</span><span class="nx">find</span> <span class="mi">1</span><span class="p">,</span> <span class="nf">(err, user) -&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">user</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span>

<span class="c1"># Find multiple by primary ID</span>
<span class="nx">User</span><span class="p">.</span><span class="nx">findAll</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="nf">(err, users) -&gt;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">user</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span> <span class="k">for</span> <span class="nx">user</span> <span class="k">in</span> <span class="nx">users</span>

<span class="c1"># Find by custom query</span>
<span class="nx">User</span><span class="p">.</span><span class="nx">find</span> <span class="s">"SELECT * FROM users WHERE id &lt; ?"</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="nf">(err, user) -&gt;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">user</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span>
</pre>
</div>


<p><strong>Updating a Record</strong></p>

<div class="highlight">
<pre><span class="nx">User</span><span class="p">.</span><span class="nx">find</span> <span class="mi">1</span><span class="p">,</span> <span class="nf">(err, user) -&gt;</span>
  <span class="nv">user.name = </span><span class="s">"Bob"</span>
  <span class="nx">user</span><span class="p">.</span><span class="nx">save</span> <span class="nf">(err) -&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">"updated!"</span>
</pre>
</div>


<p><strong>Deleting a Record</strong></p>

<div class="highlight">
<pre><span class="nx">User</span><span class="p">.</span><span class="nx">find</span> <span class="mi">1</span><span class="p">,</span> <span class="nf">(err, user) -&gt;</span>
  <span class="nx">user</span><span class="p">.</span><span class="k">delete</span> <span class="nf">(err) -&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">"deleted!"</span>
</pre>
</div>


<p><strong>Model Relations</strong></p>

<div class="highlight">
<pre><span class="k">class</span> <span class="nx">User</span> <span class="k">extends</span> <span class="nx">ActiveRecord</span><span class="p">.</span><span class="nx">Model</span>
  <span class="nv">config: </span><span class="nx">config</span>
  <span class="nv">fields: </span><span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'username'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">]</span>
  <span class="nv">hasMany: </span><span class="o">-&gt;</span> <span class="p">[</span>
    <span class="nx">Message</span>
  <span class="p">]</span>

<span class="k">class</span> <span class="nx">Message</span> <span class="k">extends</span> <span class="nx">ActiveRecord</span><span class="p">.</span><span class="nx">Model</span>
  <span class="nv">config: </span><span class="nx">config</span>
  <span class="nv">fields: </span><span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'user_id'</span><span class="p">,</span> <span class="s">'text'</span><span class="p">]</span>
  <span class="nv">belongsTo: </span><span class="o">-&gt;</span> <span class="p">[</span>
    <span class="nx">User</span>
  <span class="p">]</span>

<span class="nx">Message</span><span class="p">.</span><span class="nx">find</span> <span class="mi">1</span><span class="p">,</span> <span class="nf">(message) -&gt;</span>
  <span class="nx">message</span><span class="p">.</span><span class="nx">user</span> <span class="nf">(err, user) -&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">user</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span>
</pre>
</div>


<p><strong>Non-SQL Middleware</strong></p>

<div class="highlight">
<pre><span class="k">class</span> <span class="nx">User</span> <span class="k">extends</span> <span class="nx">ActiveRecord</span><span class="p">.</span><span class="nx">Model</span>
  <span class="nv">config: </span><span class="nx">config</span>
  <span class="nv">idMiddleware: </span><span class="s">'redis'</span>
  <span class="nv">idMiddlewareOptions:</span>
    <span class="nv">key: </span><span class="s">'users:id'</span>

  <span class="nv">fields: </span><span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'username'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">]</span>
</pre>
</div>


<p><strong>Plugins</strong></p>

<div class="highlight">
<pre><span class="k">class</span> <span class="nx">AltLogger</span> <span class="k">extends</span> <span class="nx">ActiveRecord</span><span class="p">.</span><span class="nx">Plugin</span>
  <span class="nv">messages: </span><span class="p">[]</span>

  <span class="c1"># Callback hooks</span>
  <span class="nv">afterCreate: </span><span class="o">-&gt;</span> <span class="nx">messages</span><span class="p">.</span><span class="nx">push</span> <span class="s">"Created model for </span><span class="si">#{</span><span class="nx">@tableName</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">;</span> <span class="kc">true</span>
  <span class="nv">afterUpdate: </span><span class="o">-&gt;</span> <span class="nx">messages</span><span class="p">.</span><span class="nx">push</span> <span class="s">"Updated model for </span><span class="si">#{</span><span class="nx">@tableName</span><span class="p">()</span><span class="si">}</span><span class="s">"</span><span class="p">;</span> <span class="kc">true</span>

  <span class="c1"># Extend the model</span>
  <span class="nv">outputLog: </span><span class="o">-&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">msg</span> <span class="k">for</span> <span class="nx">msg</span> <span class="k">in</span> <span class="nx">messages</span>

<span class="k">class</span> <span class="nx">User</span> <span class="k">extends</span> <span class="nx">ActiveRecord</span><span class="p">.</span><span class="nx">Model</span>
  <span class="nv">config: </span><span class="nx">config</span>
  <span class="nv">fields: </span><span class="p">[</span><span class="s">'id'</span><span class="p">,</span> <span class="s">'username'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">]</span>
  <span class="nv">plugins: </span><span class="o">-&gt;</span> <span class="p">[</span>
    <span class="s">'json'</span>
    <span class="nx">AltLogger</span>
  <span class="p">]</span>

<span class="nv">user = </span><span class="k">new</span> <span class="nx">User</span> <span class="nv">name: </span><span class="s">'foo'</span><span class="p">,</span> <span class="nv">username: </span><span class="s">'bar'</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">save</span> <span class="nf">(err) -&gt;</span> <span class="nx">user</span><span class="p">.</span><span class="nx">outputLog</span><span class="p">()</span>
</pre>
</div>

      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/meltingice">meltingice</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
    
  </body>
</html>